<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Invoice System - Masterpiece</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Kantumruy+Pro:wght@300;400;700&family=Koulen&family=Moul&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* === CORE SETTINGS === */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --primary: #1f506e; 
            --accent: #d4af37;
            --bg-body: #1a1a2e;
            --font-main: 'Battambang', sans-serif;
            --font-header: 'Moul', serif;
        }

        body { 
            font-family: var(--font-main); 
            background-color: var(--bg-body); 
            margin: 0; padding: 0; 
            display: flex; justify-content: center; min-height: 100vh;
            overflow-x: hidden;
        }

        /* === ğŸ® MAGIC CONTROL PANEL (FLOATING) === */
        .control-panel {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            padding: 10px 20px; border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 15px;
            z-index: 1000; border: 1px solid rgba(255,255,255,0.2);
            animation: floatUp 0.5s ease-out;
        }

        @keyframes floatUp { from { transform: translate(-50%, 100%); } to { transform: translate(-50%, 0); } }

        /* SWITCHER WITH ANIMATION */
        .theme-switcher {
            display: flex; align-items: center; gap: 10px;
            background: #f1f5f9; padding: 5px; border-radius: 30px;
        }
        
        .nav-btn {
            width: 40px; height: 40px; border: none; border-radius: 50%;
            background: white; color: #333; font-size: 18px; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; justify-content: center;
        }
        .nav-btn:hover { background: var(--primary); color: white; transform: scale(1.1); }
        .nav-btn:active { transform: scale(0.9); }

        .theme-info { text-align: center; width: 120px; }
        .theme-name { font-size: 12px; font-weight: bold; color: #333; display: block; }
        .theme-dots { display: flex; justify-content: center; gap: 3px; margin-top: 2px; }
        .dot { width: 6px; height: 6px; background: #ccc; border-radius: 50%; transition: 0.3s; }
        .dot.active { background: var(--primary); transform: scale(1.2); }

        /* ACTION BUTTONS */
        .action-btn {
            width: 45px; height: 45px; border-radius: 50%; border: none;
            color: white; font-size: 18px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s;
        }
        .btn-print { background: #334155; }
        .btn-save { background: linear-gradient(135deg, #d4af37, #f59e0b); box-shadow: 0 0 15px rgba(245, 158, 11, 0.4); }
        
        .action-btn:hover { transform: translateY(-3px) rotate(10deg); }

        /* === ğŸ“„ INVOICE CONTAINER === */
        .invoice-wrapper { margin: 40px 0 120px 0; perspective: 1000px; }
        
        .invoice-container {
            width: 210mm; min-height: 297mm; 
            background: white; padding: 40px;
            position: relative; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-origin: top center;
        }

        /* === ğŸ¨ THEME STYLES (THE MAGIC) === */

        /* ğŸ’ THEME 1: PREMIUM GOLD (Luxury) */
        .style-premium .header-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white; padding: 40px; margin: -40px -40px 30px -40px;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
            display: flex; justify-content: space-between; align-items: flex-start;
        }
        .style-premium .company-name { color: #d4af37; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .style-premium .customer-card { border-left: 5px solid #d4af37; }
        .style-premium th { background: #f1f5f9; color: #333; border-bottom: 2px solid #ddd; }
        .style-premium .total-box { background: #0f172a; color: white; }
        .style-premium .grand-total { color: #d4af37; }
        .style-premium .watermark { display: block; opacity: 0.05; position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg); width: 80%; pointer-events: none; }

        /* ğŸ”· THEME 2: MODERN BLUE (Clean) */
        .style-modern .header-section {
            background: #1f506e; color: white; padding: 30px; margin: -40px -40px 30px -40px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .style-modern .company-name { color: white; }
        .style-modern th { background: #1f506e; color: white; }
        .style-modern .total-box { background: #1f506e; color: white; }
        .style-modern .watermark { display: none; }

        /* ğŸ“„ THEME 3: ORIGINAL (Classic Layout) */
        .style-original .header-section {
            background: white; color: #333; padding: 0; margin-bottom: 20px;
            display: grid; grid-template-columns: 140px 1fr 200px; gap: 20px; align-items: center; border-bottom: 2px solid #1f506e; padding-bottom: 20px;
        }
        .style-original .logo-area { grid-column: 1; }
        .style-original .company-info { grid-column: 2; text-align: center; }
        .style-original .invoice-meta { grid-column: 3; text-align: right; border-left: 2px solid #eee; padding-left: 10px;}
        .style-original .company-name { color: #1f506e; font-size: 28px; }
        .style-original th { background: #1f506e; color: white; }
        .style-original .total-box { background: white; color: #333; border: 2px solid #1f506e; }
        .style-original .total-box input { color: #333; border-bottom: 1px solid #ccc; }
        .style-original .watermark { display: none; }

        /* ğŸ”´ THEME 4: RED CORPORATE */
        .style-red .header-section {
            background: #b91c1c; color: white; padding: 30px; margin: -40px -40px 30px -40px;
            border-bottom: 5px solid #7f1d1d; display: flex; justify-content: space-between;
        }
        .style-red th { background: #b91c1c; color: white; }
        .style-red .total-box { background: #b91c1c; color: white; }
        .style-red .company-name { color: white; }
        .style-red .watermark { display: none; }

        /* âš« THEME 5: MINIMALIST */
        .style-minimal .header-section {
            background: white; color: black; border-bottom: 2px solid black; padding-bottom: 20px; margin-bottom: 30px;
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        .style-minimal .company-name { color: black; letter-spacing: 2px; }
        .style-minimal th { border-top: 2px solid black; border-bottom: 2px solid black; background: white; color: black; }
        .style-minimal .total-box { background: #f9f9f9; color: black; border: 1px solid #ddd; }
        .style-minimal .total-box input { color: black; border-bottom: 1px solid #aaa; }
        .style-minimal .watermark { display: none; }

        /* === COMMON ELEMENTS === */
        .logo-area {
            width: 130px; height: 130px; 
            border: 2px dashed rgba(150,150,150,0.5); border-radius: 8px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden;
            background: rgba(255,255,255,0.1); transition: 0.3s;
        }
        .logo-area:hover { background: rgba(255,255,255,0.3); border-color: white; }
        .style-original .logo-area, .style-minimal .logo-area { border-color: #ccc; background: white; }
        
        img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .company-name { font-family: 'Moul', serif; font-size: 28px; margin-bottom: 5px; line-height: 1.2; }
        .customer-card { background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-between; }
        
        .desc-box { background: #fff; border: 1px solid #e2e8f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; line-height: 1.6; }
        
        .blueprint-box { 
            height: 200px; border: 2px dashed #cbd5e1; border-radius: 8px; margin-bottom: 20px;
            display: flex; align-items: center; justify-content: center; color: #94a3b8; cursor: pointer;
        }
        
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 12px; text-align: center; }
        td { border-bottom: 1px solid #eee; }
        
        .total-box { padding: 20px; border-radius: 12px; width: 45%; margin-left: auto; }
        .grand-total { font-size: 20px; font-weight: bold; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 10px; margin-top: 10px; }
        
        input { background: transparent; border: none; outline: none; width: 100%; font-family: inherit; font-weight: bold; color: inherit; }
        [contenteditable]:hover { outline: 1px dashed #ccc; background: rgba(255,255,0,0.1); }

        /* Add Button */
        .add-btn { width: 100%; padding: 10px; border: 2px dashed #cbd5e1; background: white; color: #64748b; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 20px; }
        .add-btn:hover { border-color: var(--primary); color: var(--primary); }

        @media print {
            .control-panel { display: none !important; }
            .invoice-wrapper { margin: 0; perspective: none; }
            .invoice-container { box-shadow: none; margin: 0; width: 100%; }
            body { background: white; }
            .header-section, .total-box, th { -webkit-print-color-adjust: exact; }
            .add-btn, .delete-btn { display: none !important; }
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <div class="theme-switcher">
            <button class="nav-btn" onclick="changeTheme(-1)"><i class="fa-solid fa-chevron-left"></i></button>
            <div class="theme-info">
                <span class="theme-name" id="themeName">Premium Gold</span>
                <div class="theme-dots" id="themeDots">
                    <div class="dot active"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
                </div>
            </div>
            <button class="nav-btn" onclick="changeTheme(1)"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <div style="width:1px; height:30px; background:#ddd;"></div>
        <button class="action-btn btn-print" onclick="window.print()" title="Print"><i class="fa-solid fa-print"></i></button>
        <button class="action-btn btn-save" onclick="saveAsJPG()" title="Save JPG"><i class="fa-solid fa-download"></i></button>
    </div>

    <div class="invoice-wrapper">
        <div class="invoice-container style-premium" id="invoice">
            
            <img id="bg-watermark" class="watermark" src="">

            <div class="header-section">
                <div class="logo-area" onclick="document.getElementById('logo-upload').click()">
                    <img id="logo-img">
                    <div id="logo-placeholder" style="text-align:center; font-size:12px; color:inherit;">
                        <i class="fa-solid fa-camera fa-2x"></i><br>Logo
                    </div>
                    <input type="file" id="logo-upload" hidden onchange="loadImg(event)">
                </div>

                <div class="company-info">
                    <div class="company-name" contenteditable="true">MOBILE CABINET</div>
                    <div contenteditable="true" style="font-size:13px; opacity:0.9; line-height:1.6;">
                        á¢á¶áŸáŸá™áŠáŸ’á‹á¶á“áŸˆ áŠá¸á¡á¼ááŸá‚áŸ’á˜á¶á“á›áŸá, á—á¼á˜á·á€áŸ„á€ášáŸ’ášá·á… áŸá„áŸ’á€á¶ááŸ‹áŸáŸ†ášáŸ„á„á€áŸ’ášáŸ„á˜<br>
                        áááŸ’áŒá–áŸ„á’á·áŸáŸáŸ‚á“á‡áŸá™, ášá¶á‡á’á¶á“á¸á—áŸ’á“áŸ†á–áŸá‰
                    </div>
                    <div style="margin-top:10px; font-weight:bold; font-size:14px;">Tel: 070 684 555 / 060 241 555</div>
                </div>

                <div class="invoice-meta" style="display:none;">
                    <div style="font-size:18px; font-weight:bold; color:var(--primary);">INVOICE</div>
                    <div>NO: INV-001</div>
                    <div>DATE: <span id="static-date"></span></div>
                </div>
            </div>

            <div class="customer-card">
                <div style="width:60%">
                    <span style="font-size:11px; text-transform:uppercase; color:#888;">á¢áá·áá·á‡á“ (Bill To):</span><br>
                    <input type="text" value="CHANNIT" style="font-size:16px;">
                </div>
                <div style="text-align:right;">
                    <span style="font-size:11px; text-transform:uppercase; color:#888;">á€á¶á›á”ášá·á…áŸ’á†áŸá‘ (Date):</span><br>
                    <input type="text" id="date-input" style="text-align:right;">
                </div>
            </div>

            <div class="desc-box" contenteditable="true">
                <b>á”ášá·á™á¶á™ (Description):</b><br>
                â—» á‡á‰áŸ’á‡á¶áŸ†á„áŸá¶áŸ†á„áŸáŸá„áŸ’á€áŸá¸á€áŸ’á”á¿á„áŸáŸ’ášá‘á¶á”áŸ‹áŸ¢á áŸŠá·á“ á‚áŸ’ášáŸ„á„áŠáŸ‚á€ 100x100 á”á¶ááŠáŸ‚á€ 40x80<br>
                â—» á€áŸ’ášá¶á›á€áŸ’áŠá¶ášá€áŸ’á“á»á„á€áŸ’áá¶ášááŸ á€á˜áŸ’ášá¶áŸáŸ‹ 15á›á¸ [Free á€áŸ†ášá¶á›á€áŸ…áŸáŸŠá¼]<br>
                <b style="color:var(--primary)">â˜… áŸá˜áŸ’á‚á¶á›áŸ‹áŸˆ á‚áŸ’ášáŸ„á„á–ááŸŒ á”áŸ’ášá•áŸáŸ‡ / á€áŸ†ášá¶á›á€áŸ…áŸáŸŠá¼ á”áŸ’ášá•áŸáŸ‡ / áŸáŸ†á™á¶á”á›áŸ€á“ 0.1m</b>
            </div>

            <div class="blueprint-box" onclick="document.getElementById('bp-upload').click()">
                <img id="bp-img" style="display:none;">
                <span id="bp-text"><i class="fa-regular fa-image"></i> á…á»á…áŠá¶á€áŸ‹ášá¼á”á”áŸ’á›á„áŸ‹ (Blueprint)</span>
                <input type="file" id="bp-upload" hidden onchange="loadBp(event)">
            </div>

            <table>
                <thead>
                    <tr>
                        <th style="text-align:left; width:40%">á”ášá·á™á¶á™</th>
                        <th style="width:15%">á‘áŸ†á áŸ†</th>
                        <th style="width:10%">á…áŸ†á“á½á“</th>
                        <th style="width:15%">áá˜áŸ’á›áŸƒ</th>
                        <th style="width:15%">áŸášá»á”</th>
                        <th style="width:30px"></th>
                    </tr>
                </thead>
                <tbody id="items-body">
                    <tr>
                        <td style="text-align:left"><input type="text" value="á‘á¼ (Mobile Cabinet)"></td>
                        <td><input type="text" value="3m x 6m" style="text-align:center"></td>
                        <td><input type="number" value="1" class="qty" oninput="calc()" style="text-align:center"></td>
                        <td><input type="number" value="1650" class="price" oninput="calc()" style="text-align:center"></td>
                        <td class="total-cell" style="font-weight:bold;">0.00</td>
                        <td><i class="fa-solid fa-trash delete-btn" style="color:#ef4444; cursor:pointer;" onclick="this.closest('tr').remove();calc()"></i></td>
                    </tr>
                </tbody>
            </table>
            <button class="add-btn" onclick="addRow()">+ á”á“áŸ’ááŸ‚á˜á‘áŸ†á“á·á‰</button>

            <div style="overflow:hidden;">
                <div style="float:left; width:50%; font-size:12px; color:#666;" contenteditable="true">
                    <b>áŸá˜áŸ’á‚á¶á›áŸ‹:</b><br>- áá˜áŸ’á›áŸƒá˜á·á“á”á¼á€á”á‰áŸ’á…á¼á›á–á“áŸ’á’ (VAT Excluded)<br>- á”áŸ’ášá¶á€áŸ‹á€á€áŸ‹á˜á·á“á¢á¶á…áŠá€áœá·á‰á”á¶á“á‘áŸ
                </div>
                <div class="total-box">
                    <div style="display:flex; justify-content:space-between;"><span>áá˜áŸ’á›áŸƒáŸášá»á”:</span> <span id="grand-total">0.00$</span></div>
                    <div style="display:flex; justify-content:space-between; margin:5px 0;"><span>á”áŸ’ášá¶á€áŸ‹á€á€áŸ‹:</span> <input type="number" id="deposit" value="500" oninput="calc()" style="text-align:right; width:80px; color:inherit; border-bottom:1px solid rgba(255,255,255,0.5);"></div>
                    <div class="grand-total" style="display:flex; justify-content:space-between;"><span>á”áŸ’ášá¶á€áŸ‹á“áŸ…áŸá›áŸ‹:</span> <span id="balance">0.00$</span></div>
                </div>
            </div>

            <div style="display:flex; justify-content:space-between; margin-top:50px; padding:0 40px;">
                <div style="text-align:center; width:150px; border-top:1px solid #ccc; padding-top:10px;">á¢áŸ’á“á€á›á€áŸ‹</div>
                <div style="text-align:center; width:150px; border-top:1px solid #ccc; padding-top:10px;">á¢áŸ’á“á€á‘á·á‰</div>
            </div>
        </div>
    </div>

    <script>
        // === ğŸ­ THEME LOGIC ===
        const themes = [
            { name: "Premium Gold", class: "style-premium", color: "#d4af37" },
            { name: "Modern Blue", class: "style-modern", color: "#1f506e" },
            { name: "Original", class: "style-original", color: "#333" },
            { name: "Corporate Red", class: "style-red", color: "#b91c1c" },
            { name: "Minimalist", class: "style-minimal", color: "#000" }
        ];
        let currentIdx = 0;

        function updateTheme() {
            const container = document.getElementById('invoice');
            const t = themes[currentIdx];
            
            // Clear all classes and add current
            container.className = `invoice-container ${t.class}`;
            
            // Update UI
            document.getElementById('themeName').innerText = t.name;
            
            // Update dots
            const dots = document.querySelectorAll('.dot');
            dots.forEach((d, i) => {
                d.classList.toggle('active', i === currentIdx);
                d.style.background = (i === currentIdx) ? t.color : '#ccc';
            });

            // Specific logic for "Original" style layout visibility
            const meta = document.querySelector('.invoice-meta');
            meta.style.display = (t.class === 'style-original') ? 'block' : 'none';
        }

        function changeTheme(dir) {
            currentIdx = (currentIdx + dir + themes.length) % themes.length;
            updateTheme();
        }

        // === ğŸ–¼ï¸ IMAGE LOGIC ===
        function loadImg(e) {
            const url = URL.createObjectURL(e.target.files[0]);
            const img = document.getElementById('logo-img');
            img.src = url; img.style.display = 'block';
            document.getElementById('logo-placeholder').style.display = 'none';
            // Set Watermark
            const wm = document.getElementById('bg-watermark');
            wm.src = url; wm.style.display = 'block';
        }

        function loadBp(e) {
            const url = URL.createObjectURL(e.target.files[0]);
            document.getElementById('bp-img').src = url;
            document.getElementById('bp-img').style.display = 'block';
            document.getElementById('bp-text').style.display = 'none';
        }

        // === ğŸ§® CALCULATION ===
        function calc() {
            let rows = document.querySelectorAll('#items-body tr'), g = 0;
            rows.forEach(r => {
                let q = parseFloat(r.querySelector('.qty').value)||0, p = parseFloat(r.querySelector('.price').value)||0;
                r.querySelector('.total-cell').innerText = (q*p).toFixed(2); g += q*p;
            });
            document.getElementById('grand-total').innerText = g.toFixed(2)+'$';
            document.getElementById('balance').innerText = (g - (parseFloat(document.getElementById('deposit').value)||0)).toFixed(2)+'$';
        }

        function addRow() {
            let tr = document.createElement('tr');
            tr.innerHTML = `<td style="text-align:left"><input type="text" placeholder="..."></td><td><input type="text" class="calc-input"></td><td><input type="number" value="1" class="qty" oninput="calc()" style="text-align:center"></td><td><input type="number" value="0" class="price" oninput="calc()" style="text-align:center"></td><td class="total-cell" style="font-weight:bold;text-align:center">0.00</td><td><i class="fa-solid fa-trash delete-btn" style="color:#ef4444;cursor:pointer" onclick="this.closest('tr').remove();calc()"></i></td>`;
            document.getElementById('items-body').appendChild(tr);
        }

        function saveAsJPG() {
            const btn = document.querySelector(".btn-save");
            const oldText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
            html2canvas(document.getElementById("invoice"), { 
                scale: 4, useCORS: true,
                ignoreElements: (el) => el.classList.contains('add-btn') || el.classList.contains('delete-btn')
            }).then(c => {
                let a = document.createElement('a'); a.download = 'Invoice-Pro-' + Date.now() + '.jpg'; 
                a.href = c.toDataURL('image/jpeg', 0.95); a.click();
                btn.innerHTML = oldText;
            });
        }

        document.getElementById('date-input').value = new Date().toLocaleDateString('en-GB');
        document.getElementById('static-date').innerText = new Date().toLocaleDateString('en-GB');
        calc();
    </script>
</body>
</html>